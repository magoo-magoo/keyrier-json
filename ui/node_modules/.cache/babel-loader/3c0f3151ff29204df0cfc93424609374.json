{"ast":null,"code":"import { configuration } from '../config';\nimport { jsonBeautify, jsonParseSafe } from '../core/converters/json';\nimport { containsIgnoreCase } from '../core/converters/string';\nimport { codeEvaluation } from '@keyrier/core';\nimport { perfEnd, perfStart } from '../core/logging/performance';\nimport { arrayElementName } from '../models/array';\nimport { combineReducers } from 'redux';\nimport undoable from 'redux-undo';\nimport initialStateJson from '../state/default-state.json';\nimport { emptyState, getDefaultAppState, getDefaultUserSettingsState } from 'state/State';\nexport const rootReducer = (rootState = getDefaultAppState(), action) => {\n  var _newOutputState$table;\n\n  if (action.type === 'CLEAR_EDITOR') {\n    return emptyState;\n  }\n\n  const newState = (rootState === null || rootState === void 0 ? void 0 : rootState.query) && (rootState === null || rootState === void 0 ? void 0 : rootState.source) ? { ...rootState,\n    query: query(rootState.query, action),\n    source: source(rootState.source, action)\n  } : {};\n  const newOutputState = output(rootState, newState, action);\n  const ret = { ...newState,\n    output: { ...newOutputState,\n      table: table((_newOutputState$table = newOutputState === null || newOutputState === void 0 ? void 0 : newOutputState.table) !== null && _newOutputState$table !== void 0 ? _newOutputState$table : {}, action)\n    }\n  };\n  return ret;\n};\nexport const source = (state, action) => {\n  var _state$text, _state$text2;\n\n  switch (action.type) {\n    case 'UPDATE_SOURCE_TEXT':\n      return { ...state,\n        text: (state === null || state === void 0 ? void 0 : state.autoFormat) ? jsonBeautify(action.source.trim()) : action.source\n      };\n\n    case 'UPDATE_AUTOFORMAT_SOURCE':\n      return { ...state,\n        text: action.active ? jsonBeautify(state === null || state === void 0 ? void 0 : (_state$text = state.text) === null || _state$text === void 0 ? void 0 : _state$text.trim()) : (_state$text2 = state === null || state === void 0 ? void 0 : state.text) !== null && _state$text2 !== void 0 ? _state$text2 : '',\n        autoFormat: action.active\n      };\n\n    default:\n      return state;\n  }\n};\nexport const userSettings = (state = getDefaultUserSettingsState(), action) => {\n  switch (action.type) {\n    case 'SWITCH_GLOBAL_THEME':\n      return { ...state,\n        globalTheme: action.theme\n      };\n\n    case 'SWITCH_EDITOR_THEME':\n      return { ...state,\n        editorTheme: action.theme\n      };\n\n    case 'UPDATE_LAYOUTS':\n      return { ...state,\n        layouts: action.layouts\n      };\n\n    default:\n      return state;\n  }\n};\nexport const query = (state, action) => {\n  switch (action.type) {\n    case 'UPDATE_QUERY':\n      return { ...state,\n        text: action.query\n      };\n\n    case 'UPDATE_QUERY_MODE':\n      return { ...state,\n        mode: action.mode,\n        text: action.mode === 'SQL' ? initialStateJson.query.text : \"// data is your JSON object\\n// you can use any correct javascript code to query it\\n// in addition of that,\\n// you can use lodash helper functions. see https://lodash.com/docs/\\n// ex: _.chain(data).orderBy('age', 'desc')\\n\\n      data\\n    \"\n      };\n\n    default:\n      return state;\n  }\n};\nexport const computeOutput = (previousState, sourceString, queryString, action, mode) => {\n  const text = codeEvaluation(sourceString, queryString, mode);\n\n  if (text instanceof Error) {\n    return {\n      selectedTab: 'RawJson',\n      obj: null,\n      objSize: 0,\n      searchTerm: '',\n      match: false,\n      errorMessage: text.message,\n      table: {\n        isArray: false,\n        isModalOpen: false,\n        displayedColumns: [],\n        columns: [],\n        groupBy: []\n      }\n    };\n  }\n\n  let displayedColumns = new Array();\n  const outputObject = jsonParseSafe(text);\n\n  if (Array.isArray(outputObject)) {\n    const keyMap = {};\n    outputObject.forEach(d => {\n      if (d !== null && d !== undefined && !Object.is(d, {}) && !Array.isArray(d)) {\n        const keysToAdd = d ? typeof d === 'object' ? Object.keys(d) : [arrayElementName] : [];\n        keysToAdd.forEach(key => keyMap[key] = key);\n      }\n    });\n    displayedColumns = Object.keys(keyMap).filter(key => key && typeof key === 'string' && key.trim() !== '').sort((ax, b) => ax.toLowerCase().localeCompare(b.toLowerCase()));\n  }\n\n  const isModalOpen = previousState && previousState.table && action.type === 'TOGGLE_OUTPUT_TABLE_MODAL' ? previousState && !previousState.table.isModalOpen : previousState && previousState.table ? previousState.table.isModalOpen : false;\n  let selectedTab = Array.isArray(outputObject) ? 'Table' : 'RawJson';\n\n  if (action.type === 'UPDATE_OUTPUT_TAB_SELECTION') {\n    selectedTab = action.tab;\n  }\n\n  return {\n    selectedTab,\n    obj: outputObject,\n    objSize: text ? text.length : 0,\n    searchTerm: '',\n    match: false,\n    table: {\n      isArray: Array.isArray(outputObject),\n      isModalOpen,\n      displayedColumns,\n      columns: displayedColumns,\n      groupBy: []\n    }\n  };\n};\nexport const output = (previousState, newState, action) => {\n  var _previousState$source, _newState$source, _previousState$query, _newState$query, _newState$output2;\n\n  switch (action.type) {\n    case 'UPDATE_QUERY':\n    case 'UPDATE_SOURCE_TEXT':\n    case 'UPDATE_TABLE_COLUMNS':\n    case 'UPDATE_TABLE_GROUP_BY':\n      if ((previousState === null || previousState === void 0 ? void 0 : (_previousState$source = previousState.source) === null || _previousState$source === void 0 ? void 0 : _previousState$source.text) === (newState === null || newState === void 0 ? void 0 : (_newState$source = newState.source) === null || _newState$source === void 0 ? void 0 : _newState$source.text) && (previousState === null || previousState === void 0 ? void 0 : (_previousState$query = previousState.query) === null || _previousState$query === void 0 ? void 0 : _previousState$query.text) === (newState === null || newState === void 0 ? void 0 : (_newState$query = newState.query) === null || _newState$query === void 0 ? void 0 : _newState$query.text)) {\n        return previousState.output;\n      }\n\n      if (newState) {\n        var _newState$output, _newState$source2, _newState$query2, _newState$query3;\n\n        return computeOutput((_newState$output = newState.output) !== null && _newState$output !== void 0 ? _newState$output : {}, ((_newState$source2 = newState.source) === null || _newState$source2 === void 0 ? void 0 : _newState$source2.text) ? newState.source.text : '', ((_newState$query2 = newState.query) === null || _newState$query2 === void 0 ? void 0 : _newState$query2.text) ? newState.query.text : '', action, ((_newState$query3 = newState.query) === null || _newState$query3 === void 0 ? void 0 : _newState$query3.mode) ? newState.query.mode : 'SQL');\n      }\n\n      break;\n\n    case 'TOGGLE_OUTPUT_TABLE_MODAL':\n      return newState ? { ...newState.output,\n        table: { ...(newState.output ? newState.output.table : {}),\n          isModalOpen: ((_newState$output2 = newState.output) === null || _newState$output2 === void 0 ? void 0 : _newState$output2.table) ? !newState.output.table.isModalOpen : false\n        }\n      } : {};\n\n    case 'UPDATE_OUTPUT_TAB_SELECTION':\n      if (newState) {\n        return { ...newState.output,\n          selectedTab: action.tab\n        };\n      }\n\n      break;\n\n    case 'UPDATE_OUTPUT_SEARCH_TERM':\n      if (newState && newState.output) {\n        return { ...filter(newState.output, action.searchTerm),\n          searchTerm: action.searchTerm,\n          selectedTab: 'RawJson'\n        };\n      }\n\n      break;\n\n    default:\n      if (newState === null || newState === void 0 ? void 0 : newState.output) {\n        var _newState$source3, _newState$query4, _newState$query5;\n\n        return computeOutput(newState.output, ((_newState$source3 = newState.source) === null || _newState$source3 === void 0 ? void 0 : _newState$source3.text) ? newState.source.text : '', ((_newState$query4 = newState.query) === null || _newState$query4 === void 0 ? void 0 : _newState$query4.text) ? newState.query.text : '', action, ((_newState$query5 = newState.query) === null || _newState$query5 === void 0 ? void 0 : _newState$query5.mode) ? newState.query.mode : 'SQL');\n      }\n\n      break;\n  }\n\n  return {};\n};\nexport const containsTerm = (src, searchTerm) => {\n  if (typeof src !== 'string' && typeof src !== 'object') {\n    return {\n      match: false,\n      filteredObj: src\n    };\n  }\n\n  if (typeof src === 'string') {\n    if (containsIgnoreCase(src, searchTerm)) {\n      return {\n        match: true,\n        filteredObj: src\n      };\n    }\n\n    return {\n      match: false,\n      filteredObj: src\n    };\n  }\n\n  const obj = Array.isArray(src) ? [...src] : { ...src\n  };\n  const keys = Array.isArray(obj) ? Array.from({\n    length: obj.length\n  }, (_, k) => k) : Object.getOwnPropertyNames(obj).filter(propertyName => propertyName);\n  let result = false;\n\n  for (const propertyName of keys) {\n    const propertyNameContains = typeof propertyName === 'string' && containsIgnoreCase(propertyName, searchTerm);\n\n    if (propertyNameContains) {\n      result = true;\n      continue;\n    }\n\n    const child = obj[propertyName];\n    const {\n      match,\n      filteredObj\n    } = containsTerm(child, searchTerm);\n\n    if (propertyNameContains || match) {\n      result = true;\n      obj[propertyName] = filteredObj;\n    } else {\n      if (Array.isArray(obj) && typeof propertyName === 'number') {\n        obj.splice(propertyName, 1);\n      } else {\n        delete obj[propertyName];\n      }\n    }\n  }\n\n  if (!result) {\n    if (!Array.isArray(obj)) {\n      ;\n      keys.forEach(propertyName => delete obj[propertyName]);\n    } else {\n      obj.length = 0;\n    }\n  }\n\n  return {\n    match: result,\n    filteredObj: obj\n  };\n};\n\nconst filter = (state, searchTerm) => {\n  if (!searchTerm || searchTerm.trim() === '' || !state) {\n    return { ...state,\n      match: false\n    };\n  }\n\n  const {\n    filteredObj,\n    match\n  } = containsTerm(state.obj, searchTerm);\n\n  if (match) {\n    return { ...state,\n      obj: filteredObj,\n      match\n    };\n  }\n\n  return state;\n};\n\nconst table = (state, action) => {\n  switch (action.type) {\n    case 'UPDATE_TABLE_COLUMNS':\n      let groupByList = (state === null || state === void 0 ? void 0 : state.groupBy) ? state.groupBy : [];\n      groupByList.forEach(groupBy => {\n        if (action.columns.indexOf(groupBy) === -1) {\n          groupByList = groupByList.filter(gb => action.columns.indexOf(gb) !== -1);\n        }\n      });\n      return { ...state,\n        displayedColumns: action.columns,\n        groupBy: groupByList\n      };\n\n    case 'UPDATE_TABLE_GROUP_BY':\n      return { ...state,\n        groupBy: action.groupBy.filter(gb => state && state.displayedColumns && state.displayedColumns.indexOf(gb) !== -1).filter(gb => gb !== 'Group by...')\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport const resetApp = (state = getDefaultAppState(), action) => {\n  if (action.type === 'RESET_EDITOR') {\n    return rootReducer({ ...getDefaultAppState()\n    }, action);\n  }\n\n  return rootReducer(state, action);\n};\n\nconst perf = (state = getDefaultAppState(), action) => {\n  perfStart(`reduce - action: ${action.type}`);\n  const newState = resetApp(state, action);\n  perfEnd(`reduce - action: ${action.type}`);\n  return newState;\n};\n\nconst rootReducers = combineReducers({\n  app: undoable(perf, {\n    undoType: 'APP_UNDO',\n    redoType: 'APP_REDO',\n    limit: configuration.limitUndo\n  }),\n  userSettings\n});\nexport default rootReducers;","map":{"version":3,"sources":["/home/magoo/projects/keyrier-json/ui/src/reducers/reducers.ts"],"names":["configuration","jsonBeautify","jsonParseSafe","containsIgnoreCase","codeEvaluation","perfEnd","perfStart","arrayElementName","combineReducers","undoable","initialStateJson","emptyState","getDefaultAppState","getDefaultUserSettingsState","rootReducer","rootState","action","type","newState","query","source","newOutputState","output","ret","table","state","text","autoFormat","trim","active","userSettings","globalTheme","theme","editorTheme","layouts","mode","computeOutput","previousState","sourceString","queryString","Error","selectedTab","obj","objSize","searchTerm","match","errorMessage","message","isArray","isModalOpen","displayedColumns","columns","groupBy","Array","outputObject","keyMap","forEach","d","undefined","Object","is","keysToAdd","keys","key","filter","sort","ax","b","toLowerCase","localeCompare","tab","length","containsTerm","src","filteredObj","from","_","k","getOwnPropertyNames","propertyName","result","propertyNameContains","child","splice","groupByList","indexOf","gb","resetApp","perf","rootReducers","app","undoType","redoType","limit","limitUndo"],"mappings":"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","sourcesContent":["import { Action } from '../actions/actions'\nimport { configuration } from '../config'\nimport { jsonBeautify, jsonParseSafe } from '../core/converters/json'\nimport { containsIgnoreCase } from '../core/converters/string'\nimport { codeEvaluation } from '@keyrier/core'\nimport { perfEnd, perfStart } from '../core/logging/performance'\nimport { arrayElementName } from '../models/array'\nimport { combineReducers } from 'redux'\nimport undoable from 'redux-undo'\nimport initialStateJson from '../state/default-state.json'\nimport {\n    AppState,\n    emptyState,\n    getDefaultAppState,\n    getDefaultUserSettingsState,\n    itemType,\n    OupoutState,\n    OupoutTableState,\n    QueryMode,\n    QueryState,\n    SourceState,\n    tabType,\n    UserSettingsState,\n} from 'state/State'\n\nexport const rootReducer = (rootState = getDefaultAppState(), action: Action) => {\n    if (action.type === 'CLEAR_EDITOR') {\n        return emptyState\n    }\n    const newState =\n        rootState?.query && rootState?.source\n            ? ({\n                  ...rootState,\n                  query: query(rootState.query, action),\n                  source: source(rootState.source, action),\n              } as const)\n            : {}\n\n    const newOutputState = output(rootState, newState, action)\n    const ret = {\n        ...newState,\n        output: {\n            ...newOutputState,\n            table: table(newOutputState?.table ?? {}, action),\n        },\n    }\n\n    return ret\n}\n\nexport const source = (state: SourceState, action: Action) => {\n    switch (action.type) {\n        case 'UPDATE_SOURCE_TEXT':\n            return {\n                ...state,\n                text: state?.autoFormat ? jsonBeautify(action.source.trim()) : action.source,\n            }\n        case 'UPDATE_AUTOFORMAT_SOURCE':\n            return {\n                ...state,\n                text: action.active ? jsonBeautify(state?.text?.trim()) : state?.text ?? '',\n                autoFormat: action.active,\n            }\n        default:\n            return state\n    }\n}\n\nexport const userSettings = (state: UserSettingsState | undefined = getDefaultUserSettingsState(), action: Action) => {\n    switch (action.type) {\n        case 'SWITCH_GLOBAL_THEME':\n            return { ...state, globalTheme: action.theme }\n        case 'SWITCH_EDITOR_THEME':\n            return { ...state, editorTheme: action.theme }\n        case 'UPDATE_LAYOUTS':\n            return { ...state, layouts: action.layouts }\n        default:\n            return state\n    }\n}\n\nexport const query = (state: QueryState, action: Action) => {\n    switch (action.type) {\n        case 'UPDATE_QUERY':\n            return {\n                ...state,\n                text: action.query,\n            }\n        case 'UPDATE_QUERY_MODE':\n            return {\n                ...state,\n                mode: action.mode,\n                text:\n                    action.mode === 'SQL'\n                        ? initialStateJson.query.text\n                        : \"// data is your JSON object\\n// you can use any correct javascript code to query it\\n// in addition of that,\\n// you can use lodash helper functions. see https://lodash.com/docs/\\n// ex: _.chain(data).orderBy('age', 'desc')\\n\\n      data\\n    \",\n            } as const\n        default:\n            return state\n    }\n}\n\nexport const computeOutput = (\n    previousState: OupoutState,\n    sourceString: string,\n    queryString: string,\n    action: Action,\n    mode: QueryMode\n) => {\n    const text = codeEvaluation(sourceString, queryString, mode)\n\n    if (text instanceof Error) {\n        return {\n            selectedTab: 'RawJson',\n            obj: null,\n            objSize: 0,\n            searchTerm: '',\n            match: false,\n            errorMessage: text.message,\n            table: {\n                isArray: false,\n                isModalOpen: false,\n                displayedColumns: [],\n                columns: [],\n                groupBy: [],\n            },\n        } as const\n    }\n\n    let displayedColumns = new Array<string>()\n    const outputObject: itemType[] | object = jsonParseSafe(text)\n    if (Array.isArray(outputObject)) {\n        const keyMap: { [key: string]: string } = {}\n        outputObject.forEach(d => {\n            if (d !== null && d !== undefined && !Object.is(d, {}) && !Array.isArray(d)) {\n                const keysToAdd = d ? (typeof d === 'object' ? Object.keys(d) : [arrayElementName]) : []\n                keysToAdd.forEach(key => (keyMap[key] = key))\n            }\n        })\n        displayedColumns = Object.keys(keyMap)\n            .filter(key => key && typeof key === 'string' && key.trim() !== '')\n            .sort((ax, b) => ax.toLowerCase().localeCompare(b.toLowerCase()))\n    }\n    const isModalOpen =\n        previousState && previousState.table && action.type === 'TOGGLE_OUTPUT_TABLE_MODAL'\n            ? previousState && !previousState.table.isModalOpen\n            : previousState && previousState.table\n            ? previousState.table.isModalOpen\n            : false\n\n    let selectedTab: tabType = Array.isArray(outputObject) ? 'Table' : 'RawJson'\n\n    if (action.type === 'UPDATE_OUTPUT_TAB_SELECTION') {\n        selectedTab = action.tab\n    }\n    return {\n        selectedTab,\n        obj: outputObject,\n        objSize: text ? text.length : 0,\n        searchTerm: '',\n        match: false,\n        table: {\n            isArray: Array.isArray(outputObject),\n            isModalOpen,\n            displayedColumns,\n            columns: displayedColumns,\n            groupBy: [],\n        },\n    } as const\n}\n\nexport const output = (previousState: AppState, newState: AppState | null, action: Action) => {\n    switch (action.type) {\n        case 'UPDATE_QUERY':\n        case 'UPDATE_SOURCE_TEXT':\n        case 'UPDATE_TABLE_COLUMNS':\n        case 'UPDATE_TABLE_GROUP_BY':\n            if (\n                previousState?.source?.text === newState?.source?.text &&\n                previousState?.query?.text === newState?.query?.text\n            ) {\n                return previousState.output\n            }\n            if (newState) {\n                return computeOutput(\n                    newState.output ?? {},\n                    newState.source?.text ? newState.source.text : '',\n                    newState.query?.text ? newState.query.text : '',\n                    action,\n                    newState.query?.mode ? newState.query.mode : 'SQL'\n                )\n            }\n            break\n        case 'TOGGLE_OUTPUT_TABLE_MODAL':\n            return newState\n                ? {\n                      ...newState.output,\n                      table: {\n                          ...(newState.output ? newState.output.table : {}),\n                          isModalOpen: newState.output?.table ? !newState.output.table.isModalOpen : false,\n                      },\n                  }\n                : {}\n        case 'UPDATE_OUTPUT_TAB_SELECTION':\n            if (newState) {\n                return {\n                    ...newState.output,\n                    selectedTab: action.tab,\n                }\n            }\n            break\n        case 'UPDATE_OUTPUT_SEARCH_TERM':\n            if (newState && newState.output) {\n                return {\n                    ...filter(newState.output, action.searchTerm),\n                    searchTerm: action.searchTerm,\n                    selectedTab: 'RawJson',\n                } as const\n            }\n            break\n        default:\n            if (newState?.output) {\n                return computeOutput(\n                    newState.output,\n                    newState.source?.text ? newState.source.text : '',\n                    newState.query?.text ? newState.query.text : '',\n                    action,\n                    newState.query?.mode ? newState.query.mode : 'SQL'\n                )\n            }\n            break\n    }\n    return {}\n}\n\nexport const containsTerm = (src: any | any[] | null, searchTerm: string) => {\n    if (typeof src !== 'string' && typeof src !== 'object') {\n        return { match: false, filteredObj: src }\n    }\n\n    if (typeof src === 'string') {\n        if (containsIgnoreCase(src, searchTerm)) {\n            return { match: true, filteredObj: src }\n        }\n        return { match: false, filteredObj: src }\n    }\n    const obj: { [key: string]: any } = Array.isArray(src) ? [...src] : { ...src }\n\n    const keys = Array.isArray(obj)\n        ? Array.from({ length: obj.length }, (_, k) => k)\n        : Object.getOwnPropertyNames(obj).filter(propertyName => propertyName)\n\n    let result = false\n\n    for (const propertyName of keys) {\n        const propertyNameContains = typeof propertyName === 'string' && containsIgnoreCase(propertyName, searchTerm)\n        if (propertyNameContains) {\n            result = true\n            continue\n        }\n        const child = obj[propertyName]\n        const { match, filteredObj } = containsTerm(child, searchTerm)\n        if (propertyNameContains || match) {\n            result = true\n            obj[propertyName] = filteredObj\n        } else {\n            if (Array.isArray(obj) && typeof propertyName === 'number') {\n                obj.splice(propertyName, 1)\n            } else {\n                delete obj[propertyName]\n            }\n        }\n    }\n    if (!result) {\n        if (!Array.isArray(obj)) {\n            ;(keys as string[]).forEach((propertyName: string) => delete obj[propertyName])\n        } else {\n            obj.length = 0\n        }\n    }\n    return { match: result, filteredObj: obj }\n}\n\nconst filter = (state: OupoutState, searchTerm: string) => {\n    if (!searchTerm || searchTerm.trim() === '' || !state) {\n        return { ...state, match: false }\n    }\n    const { filteredObj, match } = containsTerm(state.obj, searchTerm)\n    if (match) {\n        return { ...state, obj: filteredObj, match }\n    }\n\n    return state\n}\n\nconst table = (state: OupoutTableState | undefined, action: Action) => {\n    switch (action.type) {\n        case 'UPDATE_TABLE_COLUMNS':\n            let groupByList = state?.groupBy ? state.groupBy : []\n            groupByList.forEach(groupBy => {\n                if (action.columns.indexOf(groupBy) === -1) {\n                    groupByList = groupByList.filter(gb => action.columns.indexOf(gb) !== -1)\n                }\n            })\n            return {\n                ...state,\n                displayedColumns: action.columns,\n                groupBy: groupByList,\n            }\n        case 'UPDATE_TABLE_GROUP_BY':\n            return {\n                ...state,\n                groupBy: action.groupBy\n                    .filter(gb => state && state.displayedColumns && state.displayedColumns.indexOf(gb) !== -1)\n                    .filter(gb => gb !== 'Group by...'),\n            }\n        default:\n            return state\n    }\n}\n\nexport const resetApp = (state = getDefaultAppState(), action: Action) => {\n    if (action.type === 'RESET_EDITOR') {\n        return rootReducer({ ...getDefaultAppState() }, action)\n    }\n    return rootReducer(state, action)\n}\n\nconst perf = (state = getDefaultAppState(), action: Action) => {\n    perfStart(`reduce - action: ${action.type}`)\n    const newState = resetApp(state, action)\n    perfEnd(`reduce - action: ${action.type}`)\n    return newState\n}\n\nconst rootReducers = combineReducers({\n    app: undoable(perf, { undoType: 'APP_UNDO', redoType: 'APP_REDO', limit: configuration.limitUndo }),\n    userSettings,\n})\nexport default rootReducers\n"]},"metadata":{},"sourceType":"module"}