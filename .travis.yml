dist: xenial
services: docker
language: node_js
node_js:
    - '12'

cache:
    npm: true
    directories:
        - node_modules
        - .cache/electron
        - .cache/electron-builder
        - .cache
        - .cache/Cypress

before_install:
    - sudo apt-get install -y libgconf-2-4

install:
    - yarn --frozen-lockfile

script:
    - yarn lerna run build
    - yarn lerna run pack:dockerelectron

after_success:
    - yarn lh https://deploy-preview-`echo $TRAVIS_PULL_REQUEST`--keyrier.netlify.com/

addons:
    apt:
        update: true

before_cache:
    - rm -rf $HOME/.cache/electron-builder/wine

deploy:
    - provider: releases
      api_key: $GITHUB_TOKEN
      file_glob: true
      file: dist/*
      skip_cleanup: true
      on:
          branch: master
